<script>
  import { DropletIcon, DropletSlashIcon, MoonIcon, SunIcon } from '$components/icons';

  import { getThemeFromDocument, setTheme, watchPreferredColorScheme, watchThemeAttribute } from '@janis.me/themed/js';

  const lightDarkButton = document.getElementById('nav-toggle-dark-button');
  const modeButton = document.getElementById('nav-toggle-mode-button');

  lightDarkButton?.addEventListener('click', () => {
    const currentTheme = getThemeFromDocument();
    if (!currentTheme) return;
    const [mode, scheme] = currentTheme.split('-');
    setTheme(`${mode}-${scheme === 'dark' ? 'light' : 'dark'}`);
  });

  modeButton?.addEventListener('click', () => {
    const currentTheme = getThemeFromDocument();
    if (!currentTheme) return;
    const [mode, scheme] = currentTheme.split('-');
    setTheme(`${mode === 'lucie' ? 'janis' : 'lucie'}-${scheme}`);
  });

  watchThemeAttribute(theme => {
    if (!theme) return;
    const [mode, scheme] = theme.split('-');
    const modeIcon = mode === 'lucie' ? DropletSlashIcon : DropletIcon;
    const lightDarkIcon = scheme === 'dark' ? SunIcon : MoonIcon;

    if (lightDarkButton) {
      lightDarkButton.innerHTML = '';
      const text = document.createElement('span');
      text.innerHTML = `${scheme === 'dark' ? 'light' : 'dark'}`;
      lightDarkButton.appendChild(lightDarkIcon.node[0]);
      lightDarkButton.appendChild(text);
    }
    if (modeButton) {
      modeButton.innerHTML = '';
      const text = document.createElement('span');
      text.innerHTML = `${mode === 'lucie' ? 'simple' : 'colorful'}`;
      modeButton.appendChild(modeIcon.node[0]);
      modeButton.appendChild(text);
    }
  });

  watchPreferredColorScheme(scheme => {
    const currentTheme = getThemeFromDocument();
    const currentMode = currentTheme?.split('-')[0];
    setTheme(`${currentMode}-${scheme}`);
  });
</script>

<header class="header">
  <a href="/">
    <h1 class="header__title">janis.me</h1>
  </a>

  <div class="header__buttons">
    <button
      class="header__toggle-theme-button"
      id="nav-toggle-dark-button"
      aria-label="toggle dark/light mode"
      title="dark/light"></button>
    <button
      class="header__toggle-theme-button"
      id="nav-toggle-mode-button"
      aria-label="toggle color mode"
      title="colorful/simple"></button>
  </div>
</header>

<style lang="scss">
  @use '$styles/globals' as *;

  .header {
    width: 100%;
    height: 100%;
    padding: 0 themed('size-64');
    background-color: themed('background');

    display: flex;
    justify-content: space-between;
    align-items: center;

    border-bottom: 1px solid themed('gray-8');

    &__title {
      margin: 0;
    }

    &__buttons {
      display: flex;
      gap: themed('size-16');
    }

    &__toggle-theme-button {
      color: themed('text');
      background-color: transparent;
      border: none;
      cursor: pointer;
      font-size: 1.3rem;

      display: flex;
      align-items: center;
      justify-content: center;
      flex-flow: column;
      gap: themed('size-4');
      width: themed('size-32');

      :global(span) {
        font-size: 0.8rem;
      }
    }

    @include media('<=desktop') {
      padding: 0 themed('size-32');

      &__title {
        font-size: 1.5em;
      }

      &__buttons {
        gap: themed('size-8');
      }

      &__toggle-theme-button {
        width: themed('size-24');
      }
    }

    @include media('<=tablet') {
      padding: 0 themed('size-16');

      &__title {
        font-size: 1.2em;
      }

      &__buttons {
        gap: themed('size-4');
      }

      &__toggle-theme-button {
        width: themed('size-20');
      }
    }
  }
</style>
